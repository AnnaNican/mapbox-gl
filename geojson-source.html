<link rel="import" href="../polymer/polymer.html">

<!--
Geojson source for mapbox-gl.

See https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource for
more details.

<b>Example</b>

```html
<mapbox-gl id="map"
  interactive
  map="{{map}}"
  map-style="mapbox://styles/mapbox/dark-v9"
  access-token="<MAPBOX_ACCESS_TOKEN>"
  latitude=1.3521
  longitude=103.8698
  zoom=2></mapbox-gl>

<mapbox-layer
  map="[[map]]"
  layer-id="coastline_fill"
  rendering-type="fill"
  source="geojsonsrc"
  color="#009688"
  opacity=0.7></mapbox-layer>

<mapbox-layer
  map="[[map]]"
  layer-id="coastline_outline"
  rendering-type="line"
  source="geojsonsrc"
  color="#eee"
  line-width=2></mapbox-layer>

<geojson-source
  map="[[map]]"
  source-id="geojsonsrc"
  source-data="https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_110m_land.geojson"></geojson-source>
```

@demo demo/geojson.html
-->

<dom-module id="geojson-source">
  <script>
  Polymer({
  is: 'geojson-source',
  properties: {
    /*
     * The (map)[https://www.mapbox.com/mapbox-gl-js/api/#Map] instance
     * returned by mapboxgl-js (`mapbox-gl` element)
     */
    map: {
      type: Object
    },
    /*
     * source id - unique id for the source layer. (Required)
     */
    sourceId: {
      type: String
    },
    /*
     * geojson object or url to a geojson file.
     */
    sourceData: {
      type: Object
    }
  },

  observers: ['_setData(sourceData, map, sourceId)'],

  _setData: function(data, map, srcId) {
    if (!map || !srcId) return;
    var src = map.getSource(srcId);
    var loaded = map.loaded();

    if (src && loaded) {
      src.setData(data);
    } else if (!loaded) {
      map.on('load', function() {
        map.addSource(srcId, {
          type: 'geojson',
          data: data
        });
      });
    } else {
      map.addSource(srcId, {
        type: 'geojson',
        data: data
      });
    }
  }
});
</script>
</dom-module>
